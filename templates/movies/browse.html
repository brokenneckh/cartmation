{% extends 'base.html' %}
{% block title %}Browse - Cartmation{% endblock %}
{% block content %}

<div class="filter-bar">
    <form method="get" action="{% url 'browse' %}" class="d-flex flex-wrap gap-2 w-100">
        <input type="text" name="q" value="{{ query|default:'' }}" placeholder="Search titles..." class="filter-input">
        <select name="genre" class="filter-select">
            <option value="">All Genres</option>
            {% for g in genres %}
            <option value="{{ g.pk }}" {% if selected_genre == g.pk|stringformat:"s" %}selected{% endif %}>{{ g.name }}</option>
            {% endfor %}
        </select>
        <select name="type" class="filter-select">
            <option value="">All Types</option>
            <option value="movie" {% if selected_type == 'movie' %}selected{% endif %}>Movies</option>
            <option value="series" {% if selected_type == 'series' %}selected{% endif %}>TV Series</option>
        </select>
        <button type="submit" class="btn-green">Filter</button>
        <a href="{% url 'browse' %}" class="topbar-btn">Clear</a>
    </form>
</div>

{% if movies %}
<div class="browse-grid">
    {% for movie in movies %}
    <a href="{% url 'movie_detail' movie.pk %}" class="poster-card" style="flex:unset; width:100%;">
        {% if movie.thumbnail %}
        <img src="{{ movie.thumbnail.url }}" alt="{{ movie.title }}" class="poster-card-img">
        {% else %}
        <div class="poster-card-no-img">{{ movie.title }}</div>
        {% endif %}
        <div class="poster-card-body">
            <div class="poster-card-title">{{ movie.title }}</div>
            <div class="poster-card-meta">{{ movie.release_year }} &bull; ⭐ {{ movie.avg_rating }} &bull; {{ movie.get_content_type_display }}</div>
        </div>
    </a>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <i class="fas fa-film fa-4x mb-3" style="color:#333;"></i>
    <h4 style="color:#555;">No titles found.</h4>
    <a href="{% url 'browse' %}" class="btn-green mt-3 d-inline-block px-4 py-2 rounded-pill text-decoration-none">Clear Filters</a>
</div>
{% endif %}
{% endblock %}
