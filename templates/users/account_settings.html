{% extends 'base.html' %}
{% block title %}Account Settings - Cartmation{% endblock %}
{% block content %}
<div class="detail-content" style="max-width:700px;">
    <h2 class="fw-bold mb-5"><i class="fas fa-cog me-2" style="color:#1db954;"></i>Account Settings</h2>

    <!-- Profile Info -->
    <div class="settings-card">
        <h5 class="fw-bold mb-4" style="color:#1db954;"><i class="fas fa-user me-2"></i>Profile Information</h5>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="action" value="update_profile">
            <div class="mb-3">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">USERNAME</label>
                <input type="text" name="username" value="{{ user.username }}" class="form-control auth-input">
            </div>
            <div class="mb-3">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">EMAIL</label>
                <input type="email" value="{{ user.email }}" class="form-control auth-input" disabled>
            </div>
            <div class="mb-3">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">AVATAR</label>
                {% if user.avatar %}
                <img src="{{ user.avatar.url }}" class="rounded-circle mb-2" width="50" height="50" style="object-fit:cover;">
                {% endif %}
                <input type="file" name="avatar" class="form-control auth-input" accept="image/*">
            </div>
            <div class="mb-4">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">PLAN</label>
                <input type="text" value="{{ user.get_subscription_display }}" class="form-control auth-input" disabled>
            </div>
            <button type="submit" class="btn-green px-4 py-2 rounded-pill border-0">Save Changes</button>
        </form>
    </div>

    <!-- Change Password -->
    <div class="settings-card">
        <h5 class="fw-bold mb-4" style="color:#1db954;"><i class="fas fa-lock me-2"></i>Change Password</h5>
        <form method="post">
            {% csrf_token %}
            <input type="hidden" name="action" value="change_password">
            <div class="mb-3">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">CURRENT PASSWORD</label>
                <input type="password" name="old_password" class="form-control auth-input" placeholder="Current password" required>
            </div>
            <div class="mb-3">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">NEW PASSWORD</label>
                <input type="password" name="new_password1" class="form-control auth-input" placeholder="New password" required>
            </div>
            <div class="mb-4">
                <label class="d-block mb-1" style="color:#6a6a6a; font-size:0.8rem;">CONFIRM NEW PASSWORD</label>
                <input type="password" name="new_password2" class="form-control auth-input" placeholder="Confirm new password" required>
            </div>
            <button type="submit" class="topbar-btn">Change Password</button>
        </form>
    </div>

    <!-- Stats -->
    <div class="settings-card">
        <h5 class="fw-bold mb-4" style="color:#1db954;"><i class="fas fa-chart-bar me-2"></i>My Stats</h5>
        <div class="row text-center">
            <div class="col-4">
                <div class="display-6 fw-bold" style="color:#1db954;">{{ user.watch_history.count }}</div>
                <small style="color:#6a6a6a;">Watched</small>
            </div>
            <div class="col-4">
                <div class="display-6 fw-bold" style="color:#1db954;">{{ user.ratings.count }}</div>
                <small style="color:#6a6a6a;">Rated</small>
            </div>
            <div class="col-4">
                <div class="display-6 fw-bold" style="color:#1db954;">{{ user.comments.count }}</div>
                <small style="color:#6a6a6a;">Reviews</small>
            </div>
        </div>
    </div>
</div>
{% endblock %}

